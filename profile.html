<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tutor Profile - IndianTutors</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .tab-button.active {
            border-bottom: 2px solid #4f46e5;
            color: #4f46e5;
            font-weight: 600;
        }
        .availability-grid {
            display: grid;
            grid-template-columns: 80px repeat(7, 1fr);
            gap: 1px;
            background-color: #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
        }
        .availability-cell {
            background-color: white;
            padding: 8px;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
        }
        .availability-cell.header {
            background-color: #f9fafb;
            font-weight: 600;
            color: #374151;
        }
        .availability-cell.time-label {
            background-color: #f9fafb;
            font-weight: 500;
            color: #6b7280;
        }
        .availability-cell.available {
            background-color: #dcfce7;
            color: #166534;
            cursor: pointer;
            transition: all 0.2s;
        }
        .availability-cell.available:hover {
            background-color: #bbf7d0;
        }
        .availability-cell.unavailable {
            background-color: #f3f4f6;
            color: #9ca3af;
        }
        .sticky-sidebar {
            position: sticky;
            top: 2rem;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
        }
        .interest-tag {
            display: inline-block;
            background-color: #f3f4f6;
            color: #374151;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            margin: 0.125rem;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <a href="home.html" class="text-2xl font-bold text-indigo-600">IndianTutors</a>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="findteacher.html" class="text-gray-600 hover:text-gray-900 flex items-center space-x-1">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                        </svg>
                        <span>Back to Tutors</span>
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Loading State -->
    <div id="loadingState" class="flex items-center justify-center min-h-screen">
        <div class="text-center">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"></div>
            <p class="text-gray-600 mt-4">Loading tutor profile...</p>
        </div>
    </div>

    <!-- Error State -->
    <div id="errorState" class="hidden flex items-center justify-center min-h-screen">
        <div class="text-center">
            <h2 class="text-2xl font-bold text-gray-900 mb-2">Tutor Not Found</h2>
            <p class="text-gray-600 mb-4">The tutor profile you're looking for doesn't exist.</p>
            <a href="findteacher.html" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700">
                Browse Tutors
            </a>
        </div>
    </div>

    <!-- Profile Content -->
    <div id="profileContent" class="hidden max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Left Section (Main Content) -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Tutor Header -->
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                    <div class="flex items-start space-x-6 mb-6">
                        <div class="relative">
                            <img id="tutorAvatar" src="" alt="Tutor" class="w-24 h-24 rounded-full object-cover border-2 border-gray-100">
                            <div id="onlineStatus" class="absolute bottom-1 right-1 w-4 h-4 bg-green-500 rounded-full border-2 border-white"></div>
                        </div>
                        <div class="flex-1">
                            <div class="flex items-center space-x-3 mb-2">
                                <h1 id="tutorName" class="text-3xl font-bold text-gray-900"></h1>
                                <span id="tutorFlag" class="text-2xl"></span>
                                <span id="professionalBadge" class="hidden bg-blue-600 text-white text-xs px-3 py-1 rounded-full font-medium">PROFESSIONAL TEACHER</span>
                            </div>

                            <!-- Languages Taught -->
                            <div class="mb-3">
                                <span class="text-sm text-gray-500">Teaches</span>
                                <div id="teachesLanguages" class="flex flex-wrap gap-2 mt-1">
                                    <!-- Will be populated -->
                                </div>
                            </div>

                            <!-- Languages Spoken -->
                            <div class="mb-4">
                                <span class="text-sm text-gray-500">Speaks</span>
                                <div id="speaksLanguages" class="flex flex-wrap gap-2 mt-1">
                                    <!-- Will be populated -->
                                </div>
                            </div>

                            <!-- Specialties -->
                            <div class="mb-4">
                                <span class="text-sm text-gray-500">Specialties</span>
                                <div id="specialties" class="flex flex-wrap gap-2 mt-1">
                                    <!-- Will be populated -->
                                </div>
                            </div>

                            <!-- Short Description -->
                            <p id="shortDescription" class="text-gray-700 leading-relaxed"></p>
                        </div>
                    </div>
                </div>

                <!-- Stats Section -->
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                    <div class="stats-grid text-center">
                        <div>
                            <div class="flex items-center justify-center mb-2">
                                <span id="tutorRating" class="text-2xl text-yellow-500 mr-1"></span>
                                <span id="tutorRatingNumber" class="text-2xl font-bold text-gray-900"></span>
                            </div>
                            <div class="text-sm text-gray-500">Rating</div>
                        </div>
                        <div>
                            <div id="totalStudents" class="text-2xl font-bold text-gray-900 mb-2"></div>
                            <div class="text-sm text-gray-500">Students</div>
                        </div>
                        <div>
                            <div id="totalLessons" class="text-2xl font-bold text-gray-900 mb-2"></div>
                            <div class="text-sm text-gray-500">Lessons</div>
                        </div>
                        <div>
                            <div id="responseRate" class="text-2xl font-bold text-gray-900 mb-2">100%</div>
                            <div class="text-sm text-gray-500">Response rate</div>
                        </div>
                    </div>
                </div>

                <!-- Tabbed Content -->
                <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                    <!-- Tab Navigation -->
                    <div class="border-b border-gray-200">
                        <nav class="flex space-x-8 px-6">
                            <button class="tab-button active py-4 text-sm font-medium text-gray-500 hover:text-gray-700" data-tab="about">
                                About Me
                            </button>
                            <button class="tab-button py-4 text-sm font-medium text-gray-500 hover:text-gray-700" data-tab="teacher">
                                Me as a Teacher
                            </button>
                            <button class="tab-button py-4 text-sm font-medium text-gray-500 hover:text-gray-700" data-tab="style">
                                My lessons & teaching style
                            </button>
                            <button class="tab-button py-4 text-sm font-medium text-gray-500 hover:text-gray-700" data-tab="resume">
                                Resume & Certificates
                            </button>
                        </nav>
                    </div>

                    <!-- Tab Content -->
                    <div class="p-6">
                        <div id="about" class="tab-content active">
                            <div class="space-y-4">
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-900 mb-3">About Me</h3>
                                    <p id="aboutContent" class="text-gray-700 leading-relaxed mb-4"></p>
                                </div>
                                <div>
                                    <h4 class="text-md font-medium text-gray-900 mb-3">Interests</h4>
                                    <div id="interests" class="flex flex-wrap gap-2">
                                        <!-- Interest tags will be populated here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="teacher" class="tab-content">
                            <div class="space-y-4">
                                <h3 class="text-lg font-semibold text-gray-900 mb-3">Me as a Teacher</h3>
                                <p id="teacherContent" class="text-gray-700 leading-relaxed"></p>
                            </div>
                        </div>
                        <div id="style" class="tab-content">
                            <div class="space-y-4">
                                <h3 class="text-lg font-semibold text-gray-900 mb-3">My Lessons & Teaching Style</h3>
                                <p id="styleContent" class="text-gray-700 leading-relaxed"></p>
                            </div>
                        </div>
                        <div id="resume" class="tab-content">
                            <div class="space-y-4">
                                <h3 class="text-lg font-semibold text-gray-900 mb-3">Resume & Certificates</h3>
                                <p id="resumeContent" class="text-gray-700 leading-relaxed"></p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Availability Section -->
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-semibold text-gray-900">Availability</h2>
                        <div class="text-sm text-gray-500">
                            Available <span class="text-green-600 font-medium">07:00 Tomorrow</span>
                        </div>
                    </div>
                    <div id="availabilityGrid" class="availability-grid">
                        <!-- Availability grid will be generated here -->
                    </div>
                    <div class="text-center mt-4">
                        <button class="bg-gray-100 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-200 transition-colors">
                            Schedule lesson
                        </button>
                    </div>
                </div>

                <!-- Reviews Section -->
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-semibold text-gray-900"><span id="reviewCount">1,272</span> Reviews</h2>
                        <div class="flex space-x-2">
                            <button class="review-filter-btn active px-3 py-1 text-sm rounded-full bg-gray-800 text-white" data-filter="all">All</button>
                            <button class="review-filter-btn px-3 py-1 text-sm rounded-full bg-gray-100 text-gray-700 hover:bg-gray-200" data-filter="english">English</button>
                            <button class="review-filter-btn px-3 py-1 text-sm rounded-full bg-gray-100 text-gray-700 hover:bg-gray-200" data-filter="chinese">Chinese (Mandarin)</button>
                        </div>
                    </div>
                    <div id="reviewsContainer">
                        <!-- Reviews will be loaded here -->
                    </div>
                    <div class="text-center mt-6">
                        <button id="showMoreReviews" class="text-indigo-600 hover:text-indigo-700 font-medium">
                            Show more â†“
                        </button>
                    </div>
                </div>
            </div>

            <!-- Right Sidebar -->
            <div class="lg:col-span-1">
                <div class="sticky-sidebar space-y-6">
                    <!-- Video Player -->
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
                        <div id="videoContainer" class="aspect-video bg-gray-900 flex items-center justify-center relative">
                            <!-- Video will be embedded here -->
                            <div class="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center">
                                <button class="w-16 h-16 bg-white bg-opacity-90 rounded-full flex items-center justify-center hover:bg-opacity-100 transition-all">
                                    <svg class="w-6 h-6 text-gray-800 ml-1" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M8 5v10l8-5-8-5z"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Pricing Section -->
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                        <!-- Trial Lesson -->
                        <div class="mb-6">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-lg font-medium text-gray-900">Trial Lesson</span>
                                <div class="flex items-center space-x-1">
                                    <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                </div>
                            </div>
                            <div class="text-2xl font-bold text-gray-900 mb-4">USD <span id="trialPrice">8.00</span></div>
                            <button class="w-full bg-red-500 text-white py-3 px-4 rounded-lg hover:bg-red-600 transition-colors font-medium mb-3">
                                Book lesson
                            </button>
                        </div>

                        <!-- Regular Lesson -->
                        <div class="border-t pt-6">
                            <div class="text-lg font-medium text-gray-900 mb-2">Regular Lesson</div>
                            <div class="text-2xl font-bold text-gray-900 mb-4">USD <span id="regularPrice">12.00</span>+</div>
                            <div class="text-sm text-gray-500 mb-4">Package with 8% off</div>
                        </div>

                        <button class="w-full border border-gray-300 text-gray-700 py-3 px-4 rounded-lg hover:bg-gray-50 transition-colors font-medium">
                            Contact teacher
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Supabase
        const supabaseUrl = 'https://qbyyutebrgpxngvwenkd.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFieXl1dGVicmdweG5ndndlbmtkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk3MTA1NTMsImV4cCI6MjA2NTI4NjU1M30.eO8Wd0ZOqtXgvQ3BuedmSPmYVpbG3V-AXvgufLns6yY';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        // Get tutor ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        const tutorId = urlParams.get('id');

        // DOM Elements
        const loadingState = document.getElementById('loadingState');
        const errorState = document.getElementById('errorState');
        const profileContent = document.getElementById('profileContent');

        // Initialize page
        document.addEventListener('DOMContentLoaded', async () => {
            if (!tutorId) {
                showError();
                return;
            }
            await loadTutorProfile();
            setupTabNavigation();
            setupReviewFilters();
        });

        // Load tutor profile
        async function loadTutorProfile() {
            try {
                console.log('Looking for tutor with ID:', tutorId);

                const { data, error } = await supabase
                    .from('tutors')
                    .select('*')
                    .eq('id', tutorId)
                    .single();

                console.log('Supabase response:', { data, error });

                if (error) {
                    console.error('Supabase error:', error);
                    // If tutor not found, try to get any tutor for demo
                    const { data: allTutors, error: allError } = await supabase
                        .from('tutors')
                        .select('*')
                        .limit(1);

                    if (allError || !allTutors || allTutors.length === 0) {
                        console.error('No tutors found in database');
                        showError();
                        return;
                    }

                    console.log('Using first available tutor for demo:', allTutors[0]);
                    await displayTutorProfile(allTutors[0]);
                } else if (!data) {
                    console.error('No data returned for tutor');
                    showError();
                    return;
                } else {
                    await displayTutorProfile(data);
                }

                await loadReviews();
                generateAvailabilityGrid();
            } catch (error) {
                console.error('Error loading tutor profile:', error);
                showError();
            } finally {
                hideLoading();
            }
        }

        // Display tutor profile
        async function displayTutorProfile(tutor) {
            const avatarUrl = tutor.photo_url || `https://ui-avatars.com/api/?name=${encodeURIComponent(tutor.name)}&background=6366f1&color=fff&size=150`;
            const rating = tutor.rating || 4.5;
            const ratingStars = 'â­'.repeat(Math.floor(rating));
            const languages = tutor.languages_spoken && tutor.languages_spoken.length > 0 ?
                (typeof tutor.languages_spoken === 'string' ? JSON.parse(tutor.languages_spoken) : tutor.languages_spoken) :
                [{ language: tutor.native_language || tutor.language, proficiency: 'Native' }];
            const tags = tutor.tags && tutor.tags.length > 0 ?
                (typeof tutor.tags === 'string' ? JSON.parse(tutor.tags) : tutor.tags) :
                ['Conversational', 'Grammar', 'Beginner Friendly'];

            // Update header information
            document.getElementById('tutorAvatar').src = avatarUrl;
            document.getElementById('tutorName').textContent = tutor.name;
            document.getElementById('tutorFlag').textContent = tutor.country_flag || 'ðŸ‡®ðŸ‡³';

            // Show professional badge if applicable
            if (tutor.is_professional) {
                document.getElementById('professionalBadge').classList.remove('hidden');
            }

            // Update teaches languages
            const teachesLanguages = document.getElementById('teachesLanguages');
            teachesLanguages.innerHTML = `
                <span class="bg-indigo-100 text-indigo-800 text-sm px-3 py-1 rounded-full font-medium">
                    ${tutor.native_language || tutor.language} <span class="text-xs">Native</span>
                </span>
            `;

            // Update speaks languages
            const speaksLanguages = document.getElementById('speaksLanguages');
            speaksLanguages.innerHTML = languages.map(lang => {
                const isNative = lang.proficiency === 'Native' || lang.language === (tutor.native_language || tutor.language);
                return `<span class="bg-gray-100 text-gray-700 text-sm px-3 py-1 rounded-full">
                    ${lang.language} <span class="text-xs">${lang.proficiency || (isNative ? 'Native' : 'Fluent')}</span>
                </span>`;
            }).join('');

            // Update specialties
            const specialties = document.getElementById('specialties');
            specialties.innerHTML = `
                <span class="bg-blue-100 text-blue-800 text-sm px-3 py-1 rounded-full flex items-center">
                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2-2v2m8 0V6a2 2 0 012 2v6a2 2 0 01-2 2H8a2 2 0 01-2-2V8a2 2 0 012-2V6"></path>
                    </svg>
                    Business
                </span>
                <span class="bg-green-100 text-green-800 text-sm px-3 py-1 rounded-full flex items-center">
                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    Test Preparation
                </span>
            `;

            // Update short description
            document.getElementById('shortDescription').textContent =
                tutor.bio_headline || `Beginner - Advanced, Conversation, HSK, Business ${tutor.native_language || tutor.language}, The Writer of www.thechairmansbao.com`;

            // Update stats
            document.getElementById('tutorRating').textContent = ratingStars;
            document.getElementById('tutorRatingNumber').textContent = rating.toFixed(1);
            document.getElementById('totalStudents').textContent = tutor.total_students || Math.floor(Math.random() * 500 + 200);
            document.getElementById('totalLessons').textContent = tutor.total_lessons || Math.floor(Math.random() * 5000 + 1000);

            // Update tab content
            document.getElementById('aboutContent').textContent = tutor.about_me || tutor.bio ||
                `I have many interests and hobbies, such as playing basketball, playing ping-pong, traveling, watching NBA. I am a super fan of NBA. I went to America in March 2017, and stayed there for half a year. During this half a year, I visited many places in America, like Texas, Utah, Los Angeles, Las Vegas, Yellow Stone National Park, Grand Canyon. I like to talk about many different topics, such as travel, sports, movies, music, food, culture, business, etc.`;

            document.getElementById('teacherContent').textContent = tutor.me_as_teacher ||
                `I have been teaching ${tutor.native_language || tutor.language} for over 5 years. I am patient, friendly, and passionate about helping students achieve their language learning goals.`;

            document.getElementById('styleContent').textContent = tutor.teaching_style ||
                `My teaching style is interactive and student-centered. I focus on practical communication skills and tailor my lessons to each student's needs and interests.`;

            document.getElementById('resumeContent').textContent = tutor.resume ||
                `Bachelor's degree in ${tutor.native_language || tutor.language} Literature. Certified language teacher with 5+ years of experience. Specialized in business communication and test preparation.`;

            // Update interests
            const interests = document.getElementById('interests');
            const interestsList = ['Films & TV Series', 'Travel', 'History', 'Business & Finance', 'Sports & Fitness'];
            interests.innerHTML = interestsList.map(interest =>
                `<span class="interest-tag">${interest}</span>`
            ).join('');

            // Update pricing
            document.getElementById('trialPrice').textContent = (tutor.rate * 0.6).toFixed(2);
            document.getElementById('regularPrice').textContent = tutor.rate;

            // Update video
            const videoContainer = document.getElementById('videoContainer');
            if (tutor.video_url) {
                const videoId = extractYouTubeId(tutor.video_url);
                if (videoId) {
                    videoContainer.innerHTML = `
                        <iframe
                            width="100%"
                            height="100%"
                            src="https://www.youtube.com/embed/${videoId}"
                            frameborder="0"
                            allowfullscreen>
                        </iframe>
                    `;
                } else {
                    // Use a default video for demo
                    videoContainer.innerHTML = `
                        <iframe
                            width="100%"
                            height="100%"
                            src="https://www.youtube.com/embed/dQw4w9WgXcQ"
                            frameborder="0"
                            allowfullscreen>
                        </iframe>
                    `;
                }
            } else {
                // Use a default video for demo
                videoContainer.innerHTML = `
                    <iframe
                        width="100%"
                        height="100%"
                        src="https://www.youtube.com/embed/dQw4w9WgXcQ"
                        frameborder="0"
                        allowfullscreen>
                    </iframe>
                `;
            }

            generateAvailabilityGrid();
            profileContent.classList.remove('hidden');
        }

        // Extract YouTube video ID from URL
        function extractYouTubeId(url) {
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[2].length === 11) ? match[2] : null;
        }

        // Load reviews
        async function loadReviews() {
            try {
                const { data, error } = await supabase
                    .from('reviews')
                    .select('*')
                    .eq('tutor_id', tutorId)
                    .order('created_at', { ascending: false });

                if (error) throw error;

                displayReviews(data || []);
            } catch (error) {
                console.error('Error loading reviews:', error);
                document.getElementById('reviewsContainer').innerHTML = '<p class="text-gray-500">Unable to load reviews.</p>';
            }
        }

        // Display reviews
        function displayReviews(reviews) {
            const container = document.getElementById('reviewsContainer');

            // Sample reviews if none exist
            const sampleReviews = [
                {
                    student_name: 'Bryan',
                    lessons: 70,
                    language: 'Chinese (Mandarin)',
                    comment: 'I have been learning Chinese with Teacher Dan for almost eight months now. Today is my 50th lessons and we have finished HSK 6. His classes are always efficient, as he focuses on the key points without wasting any time, and I always feel that I get my money... Read more',
                    date: 'May 31, 2023',
                    isTeachersPick: true
                },
                {
                    student_name: 'Stephanie',
                    lessons: 230,
                    language: 'Chinese (Mandarin)',
                    comment: 'Another great lesson with Dai, as ever. Have been studying with him for over 18 months now and it\'s always instructive and fun. Thank you, Dai',
                    date: 'Feb 11, 2019',
                    isTeachersPick: true
                },
                {
                    student_name: 'Sergiy Turchyn',
                    lessons: 230,
                    language: 'Chinese (Mandarin)',
                    comment: 'Haven\'t written a review for a while. We are going through an HSK 5 textbook, almost done, focusing on vocabulary, text and exercises. Everything is good as usually.',
                    date: 'May 2, 2018',
                    isTeachersPick: true
                }
            ];

            const reviewsToShow = reviews.length > 0 ? reviews : sampleReviews;

            container.innerHTML = reviewsToShow.map(review => `
                <div class="border-b border-gray-200 pb-6 mb-6 last:border-b-0 last:pb-0 last:mb-0">
                    <div class="flex items-start space-x-4">
                        <div class="w-12 h-12 bg-indigo-100 rounded-full flex items-center justify-center flex-shrink-0">
                            <span class="text-indigo-600 font-medium text-sm">
                                ${review.student_name ? review.student_name.charAt(0).toUpperCase() : 'B'}
                            </span>
                        </div>
                        <div class="flex-1">
                            <div class="flex items-center space-x-2 mb-2">
                                <span class="font-medium text-gray-900">${review.student_name || 'Student'}</span>
                                ${review.isTeachersPick ? '<span class="bg-teal-100 text-teal-800 text-xs px-2 py-1 rounded-full">Teacher\'s pick</span>' : ''}
                            </div>
                            <div class="text-sm text-gray-500 mb-3">
                                ${review.lessons || 70} ${review.language || 'Chinese (Mandarin)'} lessons
                            </div>
                            <p class="text-gray-700 leading-relaxed mb-3">${review.comment || 'Great lesson!'}</p>
                            <div class="text-sm text-gray-500">${review.date || new Date().toLocaleDateString()}</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Setup tab navigation
        function setupTabNavigation() {
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');

            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const targetTab = button.getAttribute('data-tab');

                    // Remove active class from all buttons and contents
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    tabContents.forEach(content => content.classList.remove('active'));

                    // Add active class to clicked button and corresponding content
                    button.classList.add('active');
                    document.getElementById(targetTab).classList.add('active');
                });
            });
        }

        // Setup review filters
        function setupReviewFilters() {
            const filterButtons = document.querySelectorAll('.review-filter-btn');

            filterButtons.forEach(button => {
                button.addEventListener('click', () => {
                    // Remove active class from all buttons
                    filterButtons.forEach(btn => {
                        btn.classList.remove('active', 'bg-indigo-100', 'text-indigo-800');
                        btn.classList.add('bg-gray-100', 'text-gray-700');
                    });

                    // Add active class to clicked button
                    button.classList.add('active', 'bg-indigo-100', 'text-indigo-800');
                    button.classList.remove('bg-gray-100', 'text-gray-700');

                    // Filter reviews based on selection
                    const filter = button.getAttribute('data-filter');
                    // TODO: Implement actual filtering logic
                    console.log('Filter reviews by:', filter);
                });
            });
        }

        // Generate availability grid
        function generateAvailabilityGrid() {
            const container = document.getElementById('availabilityGrid');
            const today = new Date();
            const weekDays = ['Thu', 'Fri', 'Sat', 'Sun', 'Mon', 'Tue', 'Wed'];
            const dates = [12, 13, 14, 15, 16, 17, 18];
            const timeSlots = ['00 - 04', '04 - 08', '08 - 12', '12 - 16', '16 - 20', '20 - 24'];

            let gridHTML = '';

            // Header row
            gridHTML += '<div class="availability-cell header"></div>';
            weekDays.forEach((day, index) => {
                gridHTML += `<div class="availability-cell header">${day}<br><span class="text-xs">${dates[index]}</span></div>`;
            });

            // Time slot rows
            timeSlots.forEach(timeSlot => {
                gridHTML += `<div class="availability-cell time-label">${timeSlot}</div>`;
                weekDays.forEach(() => {
                    const isAvailable = Math.random() > 0.3; // Random availability for demo
                    gridHTML += `<div class="availability-cell ${isAvailable ? 'available' : 'unavailable'}"></div>`;
                });
            });

            container.innerHTML = gridHTML;
        }

        // Utility functions
        function hideLoading() {
            loadingState.classList.add('hidden');
        }

        function showError() {
            loadingState.classList.add('hidden');
            errorState.classList.remove('hidden');
        }
    </script>
</body>
</html>
